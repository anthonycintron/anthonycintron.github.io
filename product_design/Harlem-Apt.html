<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="authoring-tool" content="Adobe_Animate_CC">
<title>Harlem-Apt</title>
<style>
  #animation_container {
	position: relative;
	margin: 0 auto;
	width: 1080px;
	height: 1698px;
	background-color: rgba(0, 0, 0, 1.00);
  }
  .error-message {
    color: white;
    text-align: center;
    padding: 50px;
    font-family: Arial, sans-serif;
  }
  body {
    margin: 0;
    padding: 0;
    background-color: #000;
    overflow: hidden;
  }
</style>
</head>
<body style="margin:0px;">
	<div id="animation_container" style="background-color:rgba(0, 0, 0, 1.00); width:1080px; height:1698px">
		<canvas id="canvas" width="1080" height="1698" style="position: absolute; display: block; background-color:rgba(0, 0, 0, 1.00);"></canvas>
		<div id="dom_overlay_container" style="pointer-events:none; overflow:hidden; width:1080px; height:1698px; position: absolute; left: 0px; top: 0px; display: block;">
		</div>
	</div>
	
	<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
	<script src="Harlem-Apt.js"></script>
	<script>
	var canvas, stage, exportRoot, anim_container, dom_overlay_container, fnStartAnimation;
	
	function showError(message) {
		document.getElementById('animation_container').innerHTML = '<div class="error-message">' + message + '</div>';
	}
	
	function init() {
		try {
			// Check if required dependencies are loaded
			if (typeof createjs === 'undefined') {
				console.error('CreateJS library failed to load');
				showError('Animation library unavailable');
				return;
			}
			
			if (typeof AdobeAn === 'undefined') {
				console.error('Adobe Animate library failed to load');
				showError('Animation temporarily unavailable');
				return;
			}
			
			canvas = document.getElementById("canvas");
			anim_container = document.getElementById("animation_container");
			dom_overlay_container = document.getElementById("dom_overlay_container");
			
			var comp = AdobeAn.getComposition("5E33F5F7024F4F88B83C8A35F47BEF85");
			if (!comp) {
				showError('Animation composition not found');
				return;
			}
			
			var lib = comp.getLibrary();
			var loader = new createjs.LoadQueue(false);
			
			loader.addEventListener("fileload", function(evt) {
				handleFileLoad(evt, comp);
			});
			
			loader.addEventListener("complete", function(evt) {
				handleComplete(evt, comp);
			});
			
			loader.addEventListener("error", function(evt) {
				console.error('Failed to load:', evt.item);
				showError('Failed to load animation assets');
			});
			
			var manifest = lib.properties.manifest;
			if (manifest && manifest.length > 0) {
				loader.loadManifest(manifest);
			} else {
				// No manifest, proceed directly to complete
				handleComplete({target: loader}, comp);
			}
		} catch (error) {
			console.error('Animation initialization error:', error);
			showError('Animation initialization failed');
		}
	}
	
	function handleFileLoad(evt, comp) {
		try {
			var images = comp.getImages();	
			if (evt && evt.item && evt.item.type == "image") { 
				images[evt.item.id] = evt.result; 
			}
		} catch (error) {
			console.error('File load error:', error);
		}
	}
	
	function handleComplete(evt, comp) {
		try {
			var lib = comp.getLibrary();
			var ss = comp.getSpriteSheet();
			var queue = evt.target;
			var ssMetadata = lib.ssMetadata;
			
			for(var i = 0; i < ssMetadata.length; i++) {
				ss[ssMetadata[i].name] = new createjs.SpriteSheet({
					"images": [queue.getResult(ssMetadata[i].name)], 
					"frames": ssMetadata[i].frames
				});
			}
			
			exportRoot = new lib.HarlemApt();
			stage = new lib.Stage(canvas);
			
			// Add error handling for stage events
			stage.enableMouseOver(10);
			stage.mouseMoveOutside = true;
			
			fnStartAnimation = function() {
				try {
					stage.addChild(exportRoot);
					createjs.Ticker.framerate = lib.properties.fps;
					createjs.Ticker.addEventListener("tick", function(event) {
						try {
							stage.update(event);
						} catch (tickError) {
							console.error('Tick error:', tickError);
							// Remove the problematic event listener to prevent further errors
							createjs.Ticker.removeAllEventListeners("tick");
						}
					});
				} catch (startError) {
					console.error('Animation start error:', startError);
					showError('Animation failed to start');
				}
			};
			
			// Code to support hidpi screens and responsive scaling
			if (typeof AdobeAn.makeResponsive === 'function') {
				AdobeAn.makeResponsive(true, 'both', true, 1, [canvas, anim_container, dom_overlay_container]);
			}
			
			AdobeAn.compositionLoaded(lib.properties.id);
			fnStartAnimation();
			
		} catch (error) {
			console.error('Animation complete error:', error);
			showError('Animation setup failed');
		}
	}
	
	// Initialize when DOM is ready
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', init);
	} else {
		init();
	}
	
	// Global error handler
	window.addEventListener('error', function(e) {
		console.error('Global error:', e.error);
	});
	
	</script>
</body>
</html>